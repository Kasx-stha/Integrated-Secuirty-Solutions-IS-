rule Malware_Executable_Download {
    meta:
        description = "Detects potential malware executable downloads"
        severity = "critical"
    strings:
        $exe1 = "MZ" ascii
        $exe2 = ".exe" nocase
        $exe3 = ".dll" nocase
        $exe4 = ".scr" nocase
        $exe5 = ".bat" nocase
        $cmd1 = "cmd.exe" nocase
        $cmd2 = "powershell" nocase
        $sus1 = "DownloadFile" nocase
        $sus2 = "WebClient" nocase
        $sus3 = "http://" nocase fullword
    condition:
        ($exe1 at 0) or (any of ($exe*)) or (any of ($cmd*) and any of ($sus*))
}

rule Malware_C2_Communication {
    meta:
        description = "Detects patterns typical of Command & Control communications"
        severity = "critical"
    strings:
        $c2_1 = "beacon" fullword nocase
        $c2_2 = "/admin/get.php" nocase
        $c2_3 = "/gate.php" nocase
        $c2_4 = "/panel/tasks" nocase
        $c2_5 = "botnet" fullword nocase
        $c2_6 = "command_results=" nocase
        $enc1 = "base64_decode" nocase
        $enc2 = "encrypted=" nocase
        $enc3 = "AES-256" nocase
        $malware1 = "backdoor" fullword nocase
        $malware2 = "rootkit" fullword nocase
        $malware3 = "keylog" nocase
        $malware4 = "harvester" nocase
        $malware5 = "shellcode" nocase
    condition:
        (2 of ($c2_*) and any of ($enc*)) or 
        (any of ($malware*) and any of ($c2_*)) or
        (3 of ($c2_*))
}
